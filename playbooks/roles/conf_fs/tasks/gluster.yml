# Gluster FS
---
- name: Install centos-release-gluster9
  ansible.builtin.dnf:
    state: present
    name: centos-release-gluster9

- name: Install glusterfs-server
  ansible.builtin.dnf:
    state: present
    name: glusterfs-server

- name: Enable and start glusterd
  ansible.builtin.systemd:
    name: glusterd.service
    enabled: true
    state: started

- name: Gluster prove peer
  gluster.gluster.gluster_peer:
    state: present
    nodes: '{{ groups["fs"] }}'
  when: inventory_hostname == gluster_main_server

- name: Gluster create volume
  gluster.gluster.gluster_volume:
    state: present
    name: '{{ gluster_volume }}'
    replicas: 3
    bricks: '{{ gluster_data_dir }}/{{ gluster_volume }}'
    cluster: '{{ groups["fs"] }}'
  when: inventory_hostname == gluster_main_server
