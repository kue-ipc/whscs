# create tls
---
- name: Import task webuser in user role
  ansible.builtin.import_role:
    name: user
    tasks_from: webuser
  when:
    - site is not defined
    - user is defined

- name: Set site
  ansible.builtin.set_fact:
    site: '{{ user_webuser.site }}'
  when:
    - site is not defined
    - user is defined

- name: Check site
  ansible.builtin.assert:
    that: site is defined
    msg: 'Require `site` or `user` variable'
    quiet: true

- name: Task backup in tls role
  ansible.builtin.import_role:
    name: tls
    tasks_from: backup
  vars:
    tls_domain: '{{ site }}'
  when: backup

- name: Task key in tls role
  ansible.builtin.import_role:
    name: tls
    tasks_from: key
  vars:
    tls_domain: '{{ site }}'

- name: Task csr in tls role
  ansible.builtin.import_role:
    name: tls
    tasks_from: csr
  vars:
    tls_domain: '{{ site }}'

- name: Task selfsigned_cert in tls role
  ansible.builtin.import_role:
    name: tls
    tasks_from: selfsigned_cert
  vars:
    tls_domain: '{{ site }}'
  when: selfsigned
